@using Microsoft.AspNet.Identity
@using Budgeter.Models

@{
    ViewBag.Title = "Dashboard";
}

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">

<h2>@ViewBag.BudgetName</h2>

<div class="container">
    <div class="row">
        <div class="col-md-11">
            <h3>Spending vs. Budget by Category</h3>
            <div id="categories-spending-bar" style="height: 250px;"></div>
        </div>
    </div>
    <div class="row">
        
        <div class="col-md-3">
            <h3>Accounts/Balances</h3>
            @{
                var accounts = new List<Account>();
                accounts = ViewBag.Accounts;
            }
            @Html.Partial("_AccountBalances", accounts)
        </div>
        <div class="col-md-3">
            <h3>Recent Transactions</h3>
            @{ 
                var recentTrans = new List<TransactionsIndexViewModel>();
                recentTrans = ViewBag.RecentTransactions;
            }
            @Html.Partial("_RecentTransactions", recentTrans)
        </div>
        <div class="col-md-4 col-md-offset-1">
            <h3>Total Spending vs. Budget</h3>
            <div id="budget-spending-bar" style="height: 250px;"></div>
        </div>
        
    </div>
    <div class="row">    
        <div class="col-md-3">
            <h3>Income Transactions</h3>
            <div id="income-categories-pie" style="height: 250px;"></div>
        </div>
        <div class="col-md-4">
            <h3>Income vs. Spending</h3>
            <div id="income-spending-bar" style="height: 250px;"></div>
        </div>   
        <div class="col-md-3">
            <h3>Expense Transactions</h3>
            <div id="expense-categories-pie" style="height: 250px;"></div>
        </div>      
    </div>
</div>
@section scripts{
    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
    <script>
        $(function () {
            $.post('@Url.Action("GetCategoriesChart", "Home")').then(function (response) {
                new Morris.Bar({
                    element: 'categories-spending-bar',
                    data: response,
                    xkey: 'y',
                    ykeys: ['a', 'b'],
                    labels: ['Spending', 'Budget'],
                    resize: true
                })
            });
            $.post('@Url.Action("GetBudgetSpendingChart","Home")').then(function (response) {
                new Morris.Bar({
                    element: 'budget-spending-bar',
                    data: response,
                    xkey: 'y',
                    ykeys: ['a'],
                    labels: ['Totals'],
                    resize: true
                })
            });
            $.post('@Url.Action("GetIncomeExpenseChart","Home")').then(function (response) {
                new Morris.Bar({
                    element: 'income-spending-bar',
                    data: response,
                    xkey: 'y',
                    ykeys: ['a'],
                    labels: ['Totals'],
                    resize: true             
                })
            });
            $.post('@Url.Action("GetExpenseChart","Home")').then(function (response) {
                new Morris.Donut({
                    element: 'expense-categories-pie',
                    data: response,
                    resize: true
                })
            });
            $.post('@Url.Action("GetIncomeChart","Home")').then(function (response) {
                new Morris.Donut({
                    element: 'income-categories-pie',
                    data: response,
                    resize: true
                })
            });
        });

        @*$(function () {
            $.post('@Url.Action("GetIncomeExpenseChart","Home")').then(function (response) {
                new Morris.Donut({
                    element: 'income-spending-bar',
                    data: response,
                    resize: true
                })
            })
        });*@
        //Morris.Bar({
        //    element: 'categories-spending-bar',
        //    data: [
        //      { y: '2006', a: 100, b: 90 },
        //      { y: '2007', a: 75,  b: 65 },
        //      { y: '2008', a: 50,  b: 40 },
        //      { y: '2009', a: 75,  b: 65 },
        //      { y: '2010', a: 50,  b: 40 },
        //      { y: '2011', a: 75,  b: 65 },
        //      { y: '2012', a: 100, b: 90 },
        //      { y: '2013', a: 100, b: 90 },
        //      { y: '2014', a: 75,  b: 65 },
        //      { y: '2015', a: 50,  b: 40 },
        //      { y: '2016', a: 75,  b: 65 },
        //      { y: '2017', a: 50,  b: 40 },
        //      { y: '2018', a: 75,  b: 65 },
        //      { y: '2019', a: 100, b: 90 }
        //    ],
        //    xkey: 'y',
        //    ykeys: ['a', 'b'],
        //    labels: ['Spending', 'Budget']
        //});
    </script>
}